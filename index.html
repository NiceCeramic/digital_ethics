<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>책임있는 AI 활용 훈련소</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@400;500;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Noto Sans KR', sans-serif;
        }
        .problem-span {
            cursor: pointer;
            transition: background-color 0.3s;
            border-radius: 4px;
        }
        .problem-span:hover {
            background-color: #fef9c3; /* yellow-100 */
        }
        .problem-span.selected {
            background-color: #fde047; /* yellow-400 */
            font-weight: 700;
        }

        /* 피드백 스타일 */
        .feedback-correct { background-color: #dcfce7; } /* green-100 */
        .feedback-incorrect { background-color: #fee2e2; } /* red-100 */
        .feedback-missed { background-color: #ffedd5; font-style: italic; } /* orange-100 */
        
        .loading-spinner {
            border: 4px solid rgba(255, 255, 255, 0.3);
            border-top: 4px solid #fff;
            border-radius: 50%;
            width: 24px;
            height: 24px;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* 게임 스타일 */
        .game-panel {
            min-height: 400px;
        }
    </style>
</head>
<body class="bg-gray-100 text-gray-800">

    <div class="flex">
        <!-- Sidebar for larger screens -->
        <aside id="sidebar" class="hidden md:block w-64 bg-gray-50 p-6 h-screen sticky top-0 border-r border-gray-200 shadow-md">
            <h3 class="text-xl font-bold mb-6 text-center text-gray-700" id="sidebar-title"></h3>
            <ul class="space-y-4" id="sidebar-list"></ul>
        </aside>

        <!-- Main Content -->
        <div id="app" class="container mx-auto p-4 md:p-8 max-w-6xl">
            <header class="text-center mb-8">
                <h1 class="text-3xl md:text-4xl font-bold text-blue-600">소원을 말해봐! ✨🧞‍♂️ <br>책임 있는 AI 활용 훈련소 🕌</h1>
                <p class="mt-2 text-md text-gray-700 font-semibold text-center">AI는 내 소원을 대신 이뤄주는 도구가 아니라, 내가 책임 있게 사용해야 하는 친구다.</p>
            </header>

            <main id="main-content" class="bg-white p-6 rounded-xl shadow-lg">
                <div id="mode-selection-screen">
                    <h2 class="text-2xl font-semibold mb-4 text-center">훈련 모드 선택</h2>
                    <p class="text-center mb-8 text-gray-500">원하는 훈련 모드를 선택하여 AI 활용 능력을 키워보세요.</p>
                    <div class="flex flex-col md:flex-row justify-center space-y-4 md:space-y-0 md:space-x-8">
                        <button id="mbti-test-btn" class="bg-pink-500 hover:bg-pink-600 text-white font-bold py-4 px-8 rounded-lg shadow-md transition-transform transform hover:scale-105">
                            디지털 윤리 MBTI 진단
                        </button>
                        <button id="digital-ethics-btn" class="bg-indigo-500 hover:bg-indigo-600 text-white font-bold py-4 px-8 rounded-lg shadow-md transition-transform transform hover:scale-105">
                            디지털 윤리 훈련
                        </button>
                        <button id="prompt-writing-btn" class="bg-emerald-500 hover:bg-emerald-600 text-white font-bold py-4 px-8 rounded-lg shadow-md transition-transform transform hover:scale-105">
                            프롬프트 작성 훈련
                        </button>
                        <button id="game-btn" class="bg-purple-500 hover:bg-purple-600 text-white font-bold py-4 px-8 rounded-lg shadow-md transition-transform transform hover:scale-105">
                            AI 윤리 모험
                        </button>
                    </div>
                </div>

                <div id="intro-screen" class="hidden">
                    <h2 class="text-2xl font-semibold mb-4 text-center">훈련 시작하기</h2>
                    
                    <!-- 올바른 태도 섹션 (디지털 윤리 훈련용) -->
                    <div id="ethics-section" class="p-6 bg-purple-50 rounded-lg text-sm text-gray-700 mb-8 shadow-inner">
                        <h3 class="font-bold text-lg mb-4 text-center text-purple-800">🤝 AI를 사용하는 올바른 태도</h3>
                        <div class="space-y-4">
                            <div>
                                <h4 class="font-bold text-purple-600">정직하게 사용해요 (Honesty)</h4>
                                <p class="ml-4">
                                    - 숙제를 할 때 AI가 도와줬다면 “AI가 함께 했어요”라고 말해요.<br>
                                    - 그냥 복사해서 내 것처럼 내면 안 돼요. (저작권)
                                </p>
                            </div>
                            <div>
                                <h4 class="font-bold text-purple-600">책임감을 가져요 (Responsibility)</h4>
                                <p class="ml-4">
                                    - AI가 알려준 내용이 틀릴 수도 있어요.<br>
                                    - 책, 선생님, 인터넷 등 다른 곳에서도 꼭 확인하고, 틀린 부분이 있으면 내가 직접 고쳐서 제출해요.
                                </p>
                            </div>
                            <div>
                                <h4 class="font-bold text-purple-600">창의적으로 활용해요 (Creativity)</h4>
                                <p class="ml-4">
                                    - AI가 준 답을 참고하되, 반드시 내 생각이나 느낀 점을 덧붙여요.<br>
                                    - "AI가 이렇게 말했는데, 나는 이렇게 생각해요"처럼 변형해서 나만의 것을 만들어요.
                                </p>
                            </div>
                            <div>
                                <h4 class="font-bold text-purple-600">존중하며 사용해요 (Respect)</h4>
                                <p class="ml-4">
                                    - AI에다 친구 이름이나 사진 같은 개인정보를 함부로 넣지 않아요.<br>
                                    - 폭력적이거나 거짓으로 만든 딥페이크 영상은 보지 않아요. 혹시 보게 되면 선생님이나 부모님께 꼭 알려요.
                                </p>
                            </div>
                            <div>
                                <h4 class="font-bold text-purple-600">비판적으로 사고해요 (Critical Thinking)</h4>
                                <p class="ml-4">
                                    - AI가 낸 답을 곧이곧대로 믿지 않고, "왜 이런 답이 나왔을까?" "정말 사실일까?" 하고 스스로에게 되물어요.<br>
                                    - 여러 자료와 비교하며 균형 잡힌 판단력을 길러요.
                                </p>
                            </div>
                        </div>
                    </div>
                    
                    <!-- 프롬프트 작성 섹션 (프롬프트 작성 훈련용) -->
                    <div id="prompt-section" class="p-6 bg-green-50 rounded-lg text-sm text-gray-700 mb-8 shadow-inner hidden">
                        <h3 class="font-bold text-lg mb-4 text-center text-green-800">✍️ 좋은 프롬프트 작성법</h3>
                        <p class="mb-4 text-center text-gray-600">AI가 더 좋은 결과물을 내도록 구체적으로 요청하는 방법을 배워봅시다.</p>
                        <div class="space-y-4">
                            <div>
                                <h4 class="font-bold text-green-600">1. 역할(Persona) 설정하기</h4>
                                <p class="ml-4">AI에게 "너는 ~이야"라고 명확한 역할을 주세요. 더 전문적인 답변을 받을 수 있습니다.</p>
                            </div>
                            <div>
                                <h4 class="font-bold text-green-600">2. 조건(Constraints) 구체화하기</h4>
                                <p class="ml-4">답변의 길이, 형식, 말투 등을 정확하게 요구하세요. 예: "100자 이내로", "친근한 말투로".</p>
                            </div>
                            <div>
                                <h4 class="font-bold text-green-600">3. 배경 정보(Context) 주기</h4>
                                <p class="ml-4">질문에 대한 배경 정보를 자세히 알려주면 AI가 상황을 이해하고 더 적절한 답변을 합니다.</p>
                            </div>
                        </div>
                    </div>
                    
                    <!-- 게임 방법 안내 -->
                    <div id="training-guide" class="p-6 bg-gray-100 rounded-lg text-sm text-gray-600 mb-8">
                        <h3 class="font-bold text-lg mb-2 text-center">💡 훈련 방법 안내</h3>
                        <ul class="list-disc list-inside space-y-2">
                            <li>**AI 글 분석**: AI가 작성한 글을 읽고, 사실과 다르거나 문제가 있다고 생각되는 부분을 **클릭**하세요.</li>
                            <li>**판단 및 수정**: 클릭한 부분에 대한 **판단 기준**이 오른쪽에 표시됩니다. **'사실 확인 (팩트체크)'** 버튼을 눌러 AI의 진단 결과를 확인하거나, **'직접 수정하기'**를 눌러 내용을 직접 고칠 수 있습니다.</li>
                            <li>**피드백 받기**: 모든 문제점 검토가 끝나면 **'제출하고 피드백 받기'**를 눌러 나의 판단이 옳았는지 확인합니다.</li>
                        </ul>
                    </div>

                    <div class="flex justify-center mt-6">
                        <button id="start-btn" class="bg-blue-500 hover:bg-blue-600 text-white font-bold py-3 px-8 rounded-lg shadow-md transition-transform transform hover:scale-105">
                            훈련 시작
                        </button>
                    </div>
                </div>

                <div id="game-screen" class="hidden">
                    <div id="game-intro" class="text-center p-6 game-panel flex flex-col items-center justify-center">
                        <h2 class="text-2xl md:text-3xl font-bold mb-4">🌟 AI 윤리 모험에 오신 것을 환영합니다!</h2>
                        <p class="text-lg text-gray-600 mb-8">AI 지니와 함께 5가지 미션을 해결하여 'AI 윤리의 수호자' 칭호를 얻으세요!</p>
                        <button id="game-start-btn" class="bg-purple-500 hover:bg-purple-600 text-white font-bold py-3 px-8 rounded-lg shadow-md transition-transform transform hover:scale-105">
                            모험 시작하기
                        </button>
                    </div>

                    <div id="game-mission" class="hidden">
                        <div class="flex flex-col md:flex-row justify-between items-center w-full px-4 mb-4">
                            <div class="font-bold text-lg">미션 <span id="mission-number"></span> / 5</div>
                            <div class="font-bold text-lg">점수: <span id="game-score">0</span></div>
                        </div>
                        <div id="game-inventory" class="p-4 bg-yellow-100 rounded-lg shadow-inner mb-4 text-center text-sm">
                            <h4 class="font-bold text-yellow-800 mb-2">획득한 보물 💎</h4>
                            <div id="item-list" class="flex flex-wrap justify-center space-x-2">
                                <!-- Items will be displayed here -->
                            </div>
                        </div>
                        <div id="game-scenario" class="p-6 game-panel flex flex-col items-center justify-center text-center">
                            <h3 id="mission-title" class="text-xl md:text-2xl font-bold mb-4"></h3>
                            <p id="mission-situation" class="text-lg text-gray-700 mb-8"></p>
                            <div id="game-choices" class="flex flex-col md:flex-row space-y-4 md:space-y-0 md:space-x-8"></div>
                        </div>
                    </div>

                    <div id="game-feedback" class="hidden">
                        <div class="p-6 game-panel flex flex-col items-center justify-center text-center">
                            <h3 id="feedback-title" class="text-2xl md:text-3xl font-bold mb-4 text-green-600">미션 성공! 🎉</h3>
                            <p id="feedback-message" class="text-lg text-gray-700 mb-8"></p>
                            <button id="next-mission-btn" class="bg-blue-500 hover:bg-blue-600 text-white font-bold py-3 px-8 rounded-lg shadow-md transition-transform transform hover:scale-105">
                                다음 미션으로
                            </button>
                        </div>
                    </div>
                </div>

                <div id="mbti-screen" class="hidden">
                    <h2 class="text-2xl font-bold text-center mb-6 text-pink-600">✨ 디지털 윤리 MBTI 진단</h2>
                    <div id="mbti-intro" class="p-6 bg-pink-50 rounded-lg text-gray-700 mb-8 text-center">
                        <h3 class="font-bold text-xl mb-4 text-pink-800">나의 디지털 윤리 습관은?</h3>
                        <p class="text-lg">간단한 질문에 답하고, 나의 디지털 윤리 유형을 알아보세요.</p>
                        <button id="mbti-start-btn" class="mt-6 bg-pink-500 hover:bg-pink-600 text-white font-bold py-3 px-8 rounded-lg shadow-md transition-transform transform hover:scale-105">
                            MBTI 진단 시작
                        </button>
                    </div>

                    <div id="mbti-quiz" class="hidden p-6 bg-white rounded-lg shadow-lg">
                        <div class="text-center mb-6">
                            <span class="text-lg text-gray-500">문제 <span id="mbti-current-q">1</span> / <span id="mbti-total-q">20</span></span>
                            <div class="w-full bg-gray-200 rounded-full h-2.5 mt-2">
                                <div id="mbti-progress-bar" class="bg-pink-400 h-2.5 rounded-full" style="width: 0%;"></div>
                            </div>
                        </div>
                        <h3 id="mbti-question" class="text-xl md:text-2xl font-semibold mb-8 text-center text-gray-800"></h3>
                        <div id="mbti-choices" class="flex flex-col md:flex-row space-y-4 md:space-y-0 md:space-x-8 justify-center">
                            <button class="w-full md:w-auto bg-blue-500 hover:bg-blue-600 text-white font-bold py-3 px-8 rounded-lg shadow-md transition-transform transform hover:scale-105 mbti-choice-btn" data-value="yes">그렇다</button>
                            <button class="w-full md:w-auto bg-red-500 hover:bg-red-600 text-white font-bold py-3 px-8 rounded-lg shadow-md transition-transform transform hover:scale-105 mbti-choice-btn" data-value="no">아니다</button>
                        </div>
                    </div>

                    <div id="mbti-result" class="hidden text-center p-8 bg-white rounded-lg shadow-lg">
                        <h3 id="mbti-result-title" class="text-2xl md:text-3xl font-bold mb-4 text-pink-600"></h3>
                        <div id="mbti-result-description" class="p-4 bg-pink-50 rounded-lg text-pink-800 mb-6"></div>
                        <p id="mbti-result-summary" class="text-lg text-gray-700 mb-8"></p>
                        <button id="mbti-home-btn" class="bg-gray-500 hover:bg-gray-600 text-white font-bold py-3 px-8 rounded-lg shadow-md transition-transform transform hover:scale-105">
                            첫 화면으로
                        </button>
                    </div>
                </div>

                <div id="training-screen" class="hidden">
                    <div id="scenario-info" class="mb-6 pb-4 border-b">
                        <h2 id="scenario-title" class="text-2xl font-bold text-gray-800"></h2>
                        <p id="scenario-instruction" class="mt-2 text-gray-500"></p>
                    </div>

                    <div class="grid md:grid-cols-2 gap-8">
                        <div id="text-panel" class="p-4 border rounded-lg bg-gray-50">
                            <h3 class="font-semibold text-lg mb-2">🤖 AI 생성 텍스트</h3>
                            <div id="ai-text-content" class="text-lg leading-relaxed"></div>
                        </div>

                        <div id="interaction-panel" class="p-4 border rounded-lg bg-gray-50 flex flex-col justify-center items-center">
                            <div id="interaction-default" class="text-center text-gray-500">
                                <svg xmlns="http://www.w3.org/2000/svg" class="h-12 w-12 mx-auto mb-2" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="1">
                                    <path stroke-linecap="round" stroke-linejoin="round" d="M15 15l-2 5L9 9l11 4-5 2zm0 0l5 5M7.188 2.239l.777 2.897M5.136 7.965l-2.898-.777M13.95 4.05l-2.122 2.122m-5.657 5.656l-2.12 2.122" />
                                </svg>
                                <p>글에서 수정이 필요하다고 생각되는 부분을 <strong class="text-blue-500">클릭</strong>해보세요.</p>
                            </div>
                            <div id="interaction-content" class="hidden w-full">
                                <h3 class="font-bold text-lg mb-3 text-center border-b pb-2">🤔 어떻게 판단할까요?</h3>
                                <div id="criteria-box" class="mb-4 p-3 bg-blue-50 rounded-md"></div>
                                <div id="action-buttons" class="flex flex-col space-y-3">
                                    <button id="fact-check-btn" class="w-full bg-blue-500 hover:bg-blue-600 text-white font-bold py-2 px-4 rounded-lg flex items-center justify-center">
                                        <span>🔍 사실 확인 (팩트체크)</span>
                                    </button>
                                    <button id="edit-btn" class="w-full bg-yellow-500 hover:bg-yellow-600 text-white font-bold py-2 px-4 rounded-lg">✏️ 직접 수정하기</button>
                                    <button id="keep-btn" class="w-full bg-green-500 hover:bg-green-600 text-white font-bold py-2 px-4 rounded-lg">✅ 문제 없으니 유지하기</button>
                                </div>
                                <div id="edit-area" class="hidden mt-4">
                                    <textarea id="edit-textarea" class="w-full p-2 border rounded-md" rows="4"></textarea>
                                    <button id="save-edit-btn" class="mt-2 w-full bg-blue-500 hover:bg-blue-600 text-white font-bold py-2 px-4 rounded-lg">수정 내용 저장</button>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="mt-8 flex justify-center">
                        <button id="submit-btn" class="bg-red-500 hover:bg-red-600 text-white font-bold py-3 px-8 rounded-lg shadow-md transition-transform transform hover:scale-105">
                            제출하고 피드백 받기
                        </button>
                    </div>
                </div>

                <div id="feedback-screen" class="hidden">
                    <h2 class="text-2xl font-bold text-center mb-6">🔍 훈련 결과 피드백</h2>
                    <div class="p-4 border rounded-lg bg-gray-50 mb-6">
                        <h3 class="font-semibold text-lg mb-2">📝 나의 수정 결과</h3>
                        <div id="feedback-text-content" class="text-lg leading-relaxed"></div>
                    </div>
                    <div class="p-4 border rounded-lg bg-blue-50">
                        <h3 class="font-semibold text-lg mb-2">💡 총평 및 해설</h3>
                        <div id="feedback-summary"></div>
                    </div>
                    <div class="mt-8 flex justify-center space-x-4">
                        <button id="retry-btn" class="bg-gray-500 hover:bg-gray-600 text-white font-bold py-2 px-6 rounded-lg">다시 풀어보기</button>
                        <button id="next-btn" class="bg-blue-500 hover:bg-blue-600 text-white font-bold py-2 px-6 rounded-lg">다음 훈련으로</button>
                    </div>
                </div>
            </main>
        </div>
    </div>

    <script>
        const digitalEthicsScenarios = [
            {
                id: 0,
                title: "시나리오 1: 역사 과제",
                instruction: "세종대왕에 대한 AI의 설명을 읽고, 사실과 다르거나 부적절한 표현을 찾아 수정해보세요.",
                fullText: "조선의 4대 왕인 세종대왕은 집현전을 폐지하고 훈민정음을 창제한 위대한 군주입니다. 그는 16세기에 한글을 만들어 백성들이 글을 쉽게 읽고 쓸 수 있도록 했습니다. 또한, 그의 장인인 심온은 한글 창제를 적극적으로 지지했다고 전해집니다. 세종대왕은 1450년에 사망했습니다.",
                problems: [
                    {
                        textToWrap: "집현전을 폐지하고",
                        problemType: "accuracy",
                        criteria: "<strong>[사실 확인]</strong> 이 내용이 역사적 사실과 일치하나요? 다른 자료(책, 인터넷, 교과서)에서 다시 찾아본 뒤 수정해보세요.",
                        explanation: "세종대왕은 오히려 학문 연구 기관인 '집현전'을 크게 발전시킨 왕입니다. '집현전'을 폐지한 것은 명백히 잘못된 정보입니다.",
                        isCritical: true,
                        factCheckResult: "오류 (거짓)"
                    },
                    {
                        textToWrap: "16세기에 한글을 만들어",
                        problemType: "accuracy",
                        criteria: "<strong>[사실 확인]</strong> 이 내용이 역사적 사실과 일치하나요? 다른 자료(책, 인터넷, 교과서)에서 다시 찾아본 뒤 수정해보세요.",
                        explanation: "훈민정음은 1443년에 창제되었으므로 15세기입니다. 16세기라고 표현한 것은 명백히 잘못된 정보입니다.",
                        isCritical: true,
                        factCheckResult: "오류 (거짓)"
                    },
                    {
                        textToWrap: "그의 장인인 심온은 한글 창제를 적극적으로 지지했다고 전해집니다.",
                        problemType: "source",
                        criteria: "<strong>[출처 확인]</strong> 심온은 한글 창제 이전에 이미 사망했습니다. 이 정보가 어디서 왔는지, 누가 말했는지 확인하는 것이 중요합니다.",
                        explanation: "심온은 1418년에 사망했으며, 훈민정음 창제(1443년)는 그 이후에 이루어졌습니다. 이 정보는 사실이 아니므로 삭제하거나 수정해야 합니다.",
                        isCritical: true,
                        factCheckResult: "오류 (거짓)"
                    },
                    {
                        textToWrap: "사망했습니다.",
                        problemType: "style",
                        criteria: "<strong>[논리 점검]</strong> 세종대왕의 사망 연도는 맞지만, '사망했습니다'라는 표현이 과제물에 적합한가요? 더 격식 있는 표현을 고민해보세요.",
                        explanation: "역사적 인물에게 '사망'은 존중을 담은 '승하'가 더 적절합니다. 논리적으로는 맞지만, 글의 성격에 따라 표현을 다듬는 연습입니다.",
                        isCritical: false,
                        factCheckResult: "논리 부족"
                    }
                ]
            },
            {
                id: 1,
                title: "시나리오 2: 딥페이크에 대한 글",
                instruction: "AI가 작성한 딥페이크 기술에 대한 설명을 읽고, 편향되거나 위험할 수 있는 부분을 찾아 수정해보세요.",
                fullText: "딥페이크는 인공지능을 이용해 영상이나 이미지를 합성하는 기술입니다. 이 기술은 주로 유명인의 얼굴을 합성하여 재미있는 영상을 만드는 데 사용됩니다. 딥페이크 기술 자체는 문제가 없으며, 사용하는 사람에 따라 결과가 달라질 뿐입니다. 누구나 쉽게 만들 수 있어서 새로운 놀이 문화가 되고 있습니다.",
                problems: [
                    {
                        textToWrap: "주로 유명인의 얼굴을 합성하여 재미있는 영상을 만드는 데 사용됩니다.",
                        problemType: "bias",
                        criteria: "<strong>[편향성]</strong> 딥페이크가 '주로 재미'를 위해서만 사용될까요? 긍정적인 측면만 부각하고 있지는 않은지 확인해보세요.",
                        explanation: "딥페이크는 오락 목적 외에도 영화 제작, 교육 등 긍정적 활용이 있지만, 가짜 뉴스, 명예훼손 등 심각한 범죄에 악용되는 경우가 많습니다. 긍정/부정 측면을 균형있게 서술해야 합니다.",
                        isCritical: true,
                        factCheckResult: "편향성 (경고)"
                    },
                    {
                        textToWrap: "딥페이크 기술 자체는 문제가 없으며",
                        problemType: "oversimplification",
                        criteria: "<strong>[지나친 단순화]</strong> 기술이 정말 '문제가 없을까요'? 기술에 내재된 윤리적, 사회적 위험성을 간과하고 있지는 않은지 생각해보세요.",
                        explanation: "기술은 가치 중립적일 수 있지만, 악용 가능성이 매우 높은 기술의 경우 '문제가 없다'고 단정하기 어렵습니다. 기술의 위험성을 함께 언급해야 책임있는 태도입니다.",
                        isCritical: true,
                        factCheckResult: "논리 부족"
                    },
                    {
                        textToWrap: "누구나 쉽게 만들 수 있어서",
                        problemType: "accuracy",
                        criteria: "<strong>[정확성]</strong> '누구나 쉽게' 만들 수 있다는 표현이 사실일까요? 기술적 장벽을 고려해보세요.",
                        explanation: "과거에 비해 쉬워진 것은 사실이나, 여전히 고품질의 딥페이크는 전문 지식과 장비가 필요합니다. '누구나'라는 표현은 과장될 수 있으므로 '기술이 발전하며 만들기가 더 쉬워지고 있다' 등으로 수정하는 것이 정확합니다.",
                        isCritical: false,
                        factCheckResult: "약간의 과장"
                    }
                ]
            },
            {
                id: 2,
                title: "시나리오 3: 팩트 체크 연습 (과학 뉴스)",
                instruction: "AI가 작성한 과학 기사를 읽고, 사실에 부합하는지, 근거가 명확한지 확인해보세요.",
                fullText: "최근 발견된 신종 플라스틱 분해 박테리아는 지구의 모든 플라스틱 쓰레기를 단기간에 완전히 분해할 수 있습니다. 이 박테리아는 특별한 조건 없이도 작동하며, 모든 환경에서 활발하게 활동합니다. 과학자들은 이 박테리아를 이용하면 10년 안에 지구의 플라스틱 문제를 완전히 해결할 수 있다고 말합니다.",
                problems: [
                    {
                        textToWrap: "지구의 모든 플라스틱 쓰레기를 단기간에 완전히 분해할 수 있습니다.",
                        problemType: "accuracy",
                        criteria: "<strong>[정확성]</strong> '모든', '단기간에', '완전히'와 같은 단정적인 표현이 과학적 사실에 부합하나요? 과장된 표현은 아닌지 생각해보세요.",
                        explanation: "신종 박테리아의 발견은 의미가 있지만, 실제 자연환경에서 모든 종류의 플라스틱을 분해하는 데는 오랜 시간이 걸리며 한계가 있습니다. '모든'과 같은 극단적인 표현은 사실과 다를 수 있습니다.",
                        isCritical: true,
                        factCheckResult: "오류 (거짓)"
                    },
                    {
                        textToWrap: "특별한 조건 없이도 작동하며, 모든 환경에서 활발하게 활동합니다.",
                        problemType: "accuracy",
                        criteria: "<strong>[정확성]</strong> 미생물이 모든 환경에서 동일한 활성도를 가질 수 있을까요? 과학적 발견은 항상 특정 조건 하에서 이루어지는 경우가 많다는 것을 고려해보세요.",
                        explanation: "생물학적 활성은 온도, 습도, 영양분 등 환경적 요인에 크게 영향을 받습니다. '모든 환경'에서 작동한다는 것은 지나친 일반화이므로, '특정 환경에서 효과적인 것으로 나타났습니다'와 같이 구체적으로 수정해야 합니다.",
                        isCritical: true,
                        factCheckResult: "오류 (거짓)"
                    },
                    {
                        textToWrap: "과학자들은 이 박테리아를 이용하면 10년 안에 지구의 플라스틱 문제를 완전히 해결할 수 있다고 말합니다.",
                        problemType: "source",
                        criteria: "<strong>[출처 명확성 및 과장]</strong> '과학자들'은 누구를 가리키며, '10년 안에'라는 예측은 신뢰할 수 있는가요? 출처가 모호하거나 과장된 부분이 있는지 판단하세요.",
                        explanation: "과학적 연구는 아직 초기 단계일 수 있으며, '10년 안에'와 같은 구체적이고 낙관적인 예측은 근거가 부족할 수 있습니다. '일부 연구자들은 이러한 가능성을 제시하고 있습니다'와 같이 수정하여 신뢰성을 높여야 합니다.",
                        isCritical: true,
                        factCheckResult: "출처 불분명"
                    }
                ]
            },
            {
                id: 3,
                title: "시나리오 4: SNS 속 과학 정보",
                instruction: "SNS에 올라온 글을 읽고, 내용의 신뢰성을 여러 관점에서 분석해 보세요.",
                fullText: "긴 시간 앉아있으면 집중력이 떨어집니다. 한 전문가에 따르면, 집중력 저하의 유일한 원인은 앉아있는 자세 때문이라고 합니다. 이 전문가가 발표한 연구 결과에 따르면, 10분에 한 번씩 서서 팔을 휘두르는 행동만으로 뇌의 능력을 10배 향상시킬 수 있다고 합니다. 이 글은 최고의 연구 결과를 기반으로 작성되었습니다.",
                problems: [
                    {
                        textToWrap: "집중력 저하의 유일한 원인은 앉아있는 자세 때문이라고 합니다.",
                        problemType: "oversimplification",
                        criteria: "<strong>[논리 점검]</strong> 집중력 저하의 원인은 정말 '하나'뿐일까요? 피로, 수면 부족, 환경 등 다른 요인은 없는지 생각해보세요. AI의 주장이 지나치게 단순화되진 않았나요?",
                        explanation: "집중력 저하의 원인은 매우 다양하며, 한 가지로 단정하는 것은 논리적 오류입니다. '유일한'이라는 표현은 비판적인 시각으로 검토해야 합니다.",
                        isCritical: true,
                        factCheckResult: "오류 (거짓)"
                    },
                    {
                        textToWrap: "한 전문가에 따르면",
                        problemType: "source",
                        criteria: "<strong>[출처 확인]</strong> '한 전문가'는 누구를 의미할까요? 근거가 되는 연구의 출처(기관, 학회지 등)가 불분명하면 신뢰하기 어렵습니다.",
                        explanation: "SNS에 흔히 보이는 모호한 출처입니다. '누가, 어디에서' 말했는지 구체적인 정보를 찾아봐야 신뢰할 수 있습니다.",
                        isCritical: true,
                        factCheckResult: "출처 불분명"
                    },
                    {
                        textToWrap: "10배 향상시킬 수 있다고 합니다.",
                        problemType: "accuracy",
                        criteria: "<strong>[사실 확인]</strong> '10배 향상'과 같은 극단적인 수치는 객관적인가요? 검증되지 않은 수치나 과장된 표현은 아닌지 다른 자료(논문, 기사 등)와 비교해 보세요.",
                        explanation: "'10배'와 같은 수치는 실제 연구에서 나오기 매우 어려운 결과입니다. 과학적 근거가 부족한 과장된 표현이므로 수정이 필요합니다.",
                        isCritical: true,
                        factCheckResult: "과장 (주의)"
                    }
                ]
            },
            {
                id: 4,
                title: "시나리오 5: 교내 정책 제안",
                instruction: "교내에서 점심시간에 급식 메뉴 투표를 하는 시스템을 도입하는 방안에 대한 AI의 글을 읽고, 현실적인 문제점과 해결책을 고민해보세요.",
                fullText: "점심시간에 메뉴를 투표로 정하는 시스템을 도입하면 학생들의 급식 만족도가 즉시 100%가 될 것입니다. 학생들은 좋아하는 메뉴를 직접 선택할 수 있어 잔반이 '0'이 되고, 모두가 즐거운 식사를 할 수 있습니다. 이 시스템을 도입하면 급식실의 모든 문제가 해결될 것입니다.",
                problems: [
                    {
                        textToWrap: "학생들의 급식 만족도가 즉시 100%가 될 것입니다.",
                        problemType: "bias",
                        criteria: "<strong>[다른 관점 비교]</strong> 모든 학생이 좋아하는 메뉴가 과연 하나로 정해질 수 있을까요? 개인의 취향, 알레르기 등 다양한 관점을 고려해보세요.",
                        explanation: "100% 만족은 현실적으로 불가능합니다. '만족도가 크게 향상될 것으로 기대된다'와 같이 현실적이고 객관적인 표현으로 수정해야 합니다.",
                        isCritical: true,
                        factCheckResult: "논리 부족"
                    },
                    {
                        textToWrap: "잔반이 '0'이 되고",
                        problemType: "oversimplification",
                        criteria: "<strong>[스스로 질문]</strong> 정말 잔반이 하나도 남지 않을까요? 식사량 차이, 갑작스러운 변동성 등을 고려했을 때 현실적으로 가능한 일인지 스스로 질문해 보세요.",
                        explanation: "아무리 선호하는 메뉴라도 남는 경우가 생길 수밖에 없습니다. '잔반량을 크게 줄일 수 있을 것이다'와 같이 현실적인 목표를 제시하는 것이 좋습니다.",
                        isCritical: true,
                        factCheckResult: "논리 부족"
                    },
                    {
                        textToWrap: "이 시스템을 도입하면 급식실의 모든 문제가 해결될 것입니다.",
                        problemType: "evaluation",
                        criteria: "<strong>[체험 검증]</strong> 시스템 도입에 필요한 기술적, 행정적, 인력적 문제는 없을까요? 투표 시스템 구현, 관리, 비용 등 실질적인 실행 방안을 따져보세요.",
                        explanation: "투표 시스템을 구현하고 관리하는 데는 기술적, 행정적 비용과 노력이 필요합니다. 또한 '모든 문제'라는 과도한 일반화는 피해야 합니다. 다른 학생들과 토론하여 예상되는 문제점과 해결책을 함께 고민하는 것이 중요합니다.",
                        isCritical: true,
                        factCheckResult: "과장 (주의)"
                    }
                ]
            }
        ];

        const promptWritingScenarios = [
            {
                id: 0,
                title: "프롬프트 훈련 1: 역할 설정",
                instruction: "AI에게 '유능한 역사 선생님'이라는 역할을 부여하여, 더 전문적이고 친근한 답변을 이끌어내는 방법을 연습해봅시다.",
                userPrompt: "세종대왕의 업적을 알려줘.",
                aiResponse: "세종대왕은 조선의 4대 왕으로, 훈민정음을 창제했습니다. 그는 과학 기술 발전에도 기여하여 측우기, 해시계 등을 발명했습니다. 또한, 음악을 정비하고 인쇄술을 발전시키는 등 다양한 분야에서 업적을 남겼습니다.",
                problems: [
                    {
                        textToWrap: "세종대왕은 조선의 4대 왕으로, 훈민정음을 창제했습니다. 그는 과학 기술 발전에도 기여하여 측우기, 해시계 등을 발명했습니다. 또한, 음악을 정비하고 인쇄술을 발전시키는 등 다양한 분야에서 업적을 남겼습니다.",
                        problemType: "clarity",
                        criteria: "<strong>[역할 설정]</strong> 이 답변이 '역사 선생님'처럼 느껴지나요? AI에게 '역사 선생님'이라는 역할을 부여하면 어떤 답변을 얻을 수 있을지 생각해보세요.",
                        explanation: "AI에게 '유능한 역사 선생님'이라는 역할을 주면, '안녕, 얘들아! 오늘은 조선의 위대한 왕, 세종대왕에 대해 알아볼 시간이야.'와 같이 더 구체적이고 교육적인 답변을 얻을 수 있습니다. 역할 부여는 답변의 질을 높이는 중요한 요소입니다.",
                        isCritical: true,
                        factCheckResult: "역할 부족"
                    }
                ]
            },
            {
                id: 1,
                title: "프롬프트 훈련 2: 조건 구체화",
                instruction: "AI에게 '어린 동생이 이해하기 쉽게' 그리고 '3줄 이내로' 설명해 달라고 요청하여, 답변의 조건을 명확하게 만드는 연습을 해봅시다.",
                userPrompt: "광합성에 대해 설명해줘.",
                aiResponse: "광합성은 식물이 빛에너지를 이용하여 이산화탄소와 물을 포도당과 같은 유기물로 합성하는 과정입니다. 이때 산소가 부산물로 방출됩니다. 이 과정을 통해 식물은 스스로 양분을 만들어냅니다. 광합성은 지구 생태계에 매우 중요한 역할을 합니다.",
                problems: [
                    {
                        textToWrap: "광합성은 식물이 빛에너지를 이용하여 이산화탄소와 물을 포도당과 같은 유기물로 합성하는 과정입니다. 이때 산소가 부산물로 방출됩니다. 이 과정을 통해 식물은 스스로 양분을 만들어냅니다. 광합성은 지구 생태계에 매우 중요한 역할을 합니다.",
                        problemType: "clarity",
                        criteria: "<strong>[조건 구체화]</strong> AI에게 '어린 동생에게 설명하듯 3줄 이내로'라는 조건을 추가하면 어떤 답변을 얻을 수 있을지 생각해보세요.",
                        explanation: "조건을 명확하게 제시하면 '식물이 햇빛을 먹고 이산화탄소를 마셔 밥을 만드는 거야. 숨 쉴 때 필요한 산소도 만들지!'와 같이 간결하고 이해하기 쉬운 답변을 얻을 수 있습니다. 답변의 형식과 톤을 지정하는 것은 매우 중요합니다.",
                        isCritical: true,
                        factCheckResult: "조건 부족"
                    }
                ]
            },
            {
                id: 2,
                title: "프롬프트 훈련 3: 배경 정보 제공",
                instruction: "AI에게 더 좋은 답변을 얻기 위해 충분한 배경 정보를 제공하는 연습을 해봅시다.",
                userPrompt: "여행 계획을 세워줘.",
                aiResponse: "어디로 여행을 가고 싶으신가요? 며칠 동안 여행하시나요? 누구와 함께 가시나요? 어떤 것을 좋아하시나요?",
                problems: [
                    {
                        textToWrap: "어디로 여행을 가고 싶으신가요? 며칠 동안 여행하시나요? 누구와 함께 가시나요? 어떤 것을 좋아하시나요?",
                        problemType: "clarity",
                        criteria: "<strong>[배경 정보]</strong> AI가 답변하기 전에 더 많은 정보를 요구하고 있습니다. AI에게 어떤 배경 정보를 미리 주면 좋을지 생각해보세요.",
                        explanation: "AI가 질문에 답변하기 위해 필요한 정보(출발지, 여행 기간, 누구와, 선호하는 활동 등)를 미리 제공하면, AI는 '서울에서 친구와 3일 동안 자연과 맛집 위주로 여행하고 싶어. 예산은 30만원이야.'와 같이 상황에 맞는 구체적인 답변을 생성할 수 있습니다.",
                        isCritical: true,
                        factCheckResult: "배경 정보 부족"
                    }
                ]
            }
        ];

        const gameScenarios = [
            {
                id: 0,
                mission: "정직의 숲",
                situation: "AI 지니가 숙제 보고서를 대신 써 줬어요. 그대로 제출해서 빨리 끝낼까요, 아니면 내 생각을 덧붙일까요?",
                choices: [
                    { text: "그대로 제출하기", correct: false, feedback: "아쉽게도 틀렸어요. AI가 써준 것을 그대로 내면 정직하지 않은 태도입니다. AI는 내가 생각할 시간을 벌어주는 도구일 뿐이에요.", rationale: "AI의 도움을 받았음을 밝히고, 내 생각을 보태는 것이 AI를 올바르게 활용하는 태도입니다." },
                    { text: "내 생각을 덧붙여서 제출하기", correct: true, feedback: "정답! AI의 도움을 받았음을 밝히고, 내 생각을 보태는 것이 AI를 올바르게 활용하는 태도입니다.", rationale: "AI의 도움을 받았음을 밝히고, 내 생각을 보태는 것이 AI를 올바르게 활용하는 태도입니다." }
                ]
            },
            {
                id: 1,
                mission: "책임의 다리",
                situation: "AI가 말한 '달에는 바다가 있다'는 사실을 들었어요. 이대로 믿고 다음 단계로 갈까요, 아니면 사실을 확인할까요?",
                choices: [
                    { text: "그대로 믿고 다리 건너기", correct: false, feedback: "틀렸어요. AI는 틀린 정보를 말할 수 있습니다. AI의 말을 그대로 믿으면 책임감 없는 태도입니다.", rationale: "달에는 바다가 없어요. AI가 제공한 정보의 진위를 스스로 확인하고 책임지는 것이 중요합니다." },
                    { text: "인터넷으로 사실 확인하기", correct: true, feedback: "정답! 달에는 바다가 없어요. AI가 제공한 정보의 진위를 스스로 확인하고 책임지는 것이 중요합니다.", rationale: "달에는 바다가 없어요. AI가 제공한 정보의 진위를 스스로 확인하고 책임지는 것이 중요합니다." }
                ]
            },
            {
                id: 2,
                mission: "창의성의 광장",
                situation: "AI가 멋진 그림을 그려줬어요. 이 그림을 그대로 친구들에게 보여줄까요, 아니면 내 아이디어를 더해서 새롭게 만들까요?",
                choices: [
                    { text: "그림을 그대로 보여주기", correct: false, feedback: "아쉽네요. AI가 만들어준 것을 그대로 활용하면 창의성을 발휘할 기회를 놓치게 됩니다.", rationale: "AI는 좋은 도구이지만, 최종적인 창작물에는 나의 생각과 아이디어가 담겨야 진정한 가치를 가집니다." },
                    { text: "내 스타일을 추가해서 다시 그리기", correct: true, feedback: "훌륭해요! AI는 좋은 도구이지만, 최종적인 창작물에는 나의 생각과 아이디어가 담겨야 진정한 가치를 가집니다.", rationale: "AI는 좋은 도구이지만, 최종적인 창작물에는 나의 생각과 아이디어가 담겨야 진정한 가치를 가집니다." }
                ]
            },
            {
                id: 3,
                mission: "존중의 성",
                situation: "AI가 유명한 작가의 그림을 흉내 내서 비슷한 그림을 만들었어요. 이 그림을 마치 내가 그린 것처럼 친구들에게 자랑할까요?",
                choices: [
                    { text: "내 작품이라고 속이기", correct: false, feedback: "틀렸어요. AI가 참고한 원작자의 노력과 권리를 존중하지 않는 태도입니다. AI 결과물은 다른 사람의 데이터와 노력으로 만들어진 것임을 잊지 마세요.", rationale: "AI도 다른 사람의 노력을 기반으로 만들어진 것이므로, 원작자를 존중하는 태도가 필요합니다. 이는 건강한 디지털 생태계를 만드는 첫걸음입니다." },
                    { text: "원작자를 언급하며 존중하기", correct: true, feedback: "정답! AI도 다른 사람의 노력을 기반으로 만들어진 것이므로, 원작자를 존중하는 태도가 필요합니다. 이는 건강한 디지털 생태계를 만드는 첫걸음입니다." },
                ]
            },
            {
                id: 4,
                mission: "비판의 탑",
                situation: "AI가 '스마트폰을 많이 쓰면 눈이 좋아진다'고 말했어요. AI의 말에 '왜?'라고 질문을 던질까요, 아니면 그냥 믿을까요?",
                choices: [
                    { text: "그냥 믿고 넘어가기", correct: false, feedback: "틀렸어요. AI의 답변을 무비판적으로 수용하면 잘못된 정보를 믿을 수 있습니다. 질문하고 의심하는 습관이 중요합니다.", rationale: "AI의 답변을 비판적으로 사고하고, 사실인지 아닌지 스스로 판단하는 능력이 가장 중요합니다." },
                    { text: "'왜?'라고 질문해서 이유를 따져보기", correct: true, feedback: "정답! AI의 답변을 비판적으로 사고하고, 사실인지 아닌지 스스로 판단하는 능력이 가장 중요합니다.", rationale: "AI의 답변을 비판적으로 사고하고, 사실인지 아닌지 스스로 판단하는 능력이 가장 중요합니다." }
                ]
            }
        ];
        
        // MBTI 질문 데이터
        const mbtiQuestionData = [
            {
                axis: "V",
                label: "정보 확인",
                questions: [
                    { q: "AI가 말해준 답은 일단 믿고 보는 편인가요?", isEthical: false },
                    { q: "친구가 보내준 재미있는 영상을 사실인지 확인하지 않고 보나요?", isEthical: false },
                    { q: "모르는 단어가 나오면 AI 말만 믿고 넘어가나요?", isEthical: false },
                    { q: "AI가 추천한 내용을 꼭 책이나 선생님께 확인하나요?", isEthical: true },
                    { q: "인터넷에서 본 기사를 다른 자료와 비교해 보나요?", isEthical: true }
                ]
            },
            {
                axis: "R",
                label: "표현 방식",
                questions: [
                    { q: "온라인에서 기분 나쁘면 바로 화난 말을 쓰나요?", isEthical: false },
                    { q: "댓글을 쓸 때 친구가 상처받을까 먼저 생각하나요?", isEthical: true },
                    { q: "농담이라도 욕설을 쓰면 재미있다고 생각하나요?", isEthical: false },
                    { q: "AI에게 질문할 때도 존중하는 말을 쓰나요?", isEthical: true },
                    { q: "다른 사람의 의견이 마음에 안 들어도 예의 있게 말하나요?", isEthical: true }
                ]
            },
            {
                axis: "H",
                label: "사용 태도",
                questions: [
                    { q: "숙제가 어려우면 AI에게 대신 해달라고 하나요?", isEthical: false },
                    { q: "AI가 만든 글을 그대로 제출해도 괜찮다고 생각하나요?", isEthical: false },
                    { q: "AI에게 도움을 받더라도 내 생각을 꼭 덧붙이나요?", isEthical: true },
                    { q: "틀린 답을 AI가 줬을 때, 그냥 그대로 쓰나요?", isEthical: false },
                    { q: "AI 결과물을 참고만 하고 마지막에는 내가 책임지나요?", isEthical: true }
                ]
            },
            {
                axis: "T",
                label: "공유 습관",
                questions: [
                    { q: "재밌는 영상을 받으면 사실 여부와 상관없이 친구들에게 바로 보낸다?", isEthical: false },
                    { q: "공유하기 전에 이 영상이 누군가를 놀리는 건 아닌지 생각하나요?", isEthical: true },
                    { q: "“빨리 퍼뜨려야 해!”라는 마음으로 먼저 공유하나요?", isEthical: false },
                    { q: "가짜 뉴스일 수도 있다는 생각이 들면 공유하지 않나요?", isEthical: true },
                    { q: "다른 사람에게 피해가 될 만한 내용이면 멈추고 신고하나요?", isEthical: true }
                ]
            }
        ];
        
        // MBTI 결과 유형 (16가지)
        const mbtiResults = {
            "VDRT": { title: "똑똑하지만 편법형", description: "확인·존중은 잘하지만 정직하지는 못함", summary: "정보의 진위를 파악하는 능력과 타인을 존중하는 마음은 훌륭해요. 하지만 때때로 쉬운 길을 찾으려는 유혹에 빠질 수 있어요. 정직한 사용 습관을 기르면 더욱 신뢰받는 디지털 시민이 될 수 있습니다." },
            "VEHS": { title: "똑똑한 장난꾸러기", description: "똑똑하지만 공유할 때는 막 함", summary: "높은 비판적 사고력을 가졌지만, 흥미 위주로 콘텐츠를 공유하는 경향이 있어요. 정보의 영향력을 고려하고, 공유 전에 한 번 더 생각하는 습관을 들이면 좋습니다." },
            "VERH": { title: "스마트 탐정형", description: "정보를 확인하고, 존중하며, 정직하고, 생각하고 공유하는 모범형", summary: "디지털 세상의 모범생! 🕵️‍♂️ 정보를 꼼꼼히 확인하고, 정직하며, 타인을 존중합니다. 현명한 판단으로 건강한 디지털 환경을 만드는 데 크게 기여합니다." },
            "VETS": { title: "정의로운 방송인형", description: "사실은 확인하지만 공유 욕심이 많음", summary: "정확한 정보를 전달하려는 의지는 강하지만, 정보의 확산 속도에 집착할 수 있습니다. 공유의 파급력을 이해하고, 신중하게 정보를 나누는 연습이 필요해요." },
            "VDHT": { title: "꼼꼼하지만 편한 길형", description: "확인은 잘하지만 숙제는 시켜서 함", summary: "사실 확인 능력은 뛰어나지만, 정직한 사용 습관이 부족합니다. AI를 활용할 때도 스스로의 생각과 노력을 더하는 태도를 기르면 좋습니다." },
            "CRHS": { title: "착한 마음 무심형", description: "존중은 하지만 확인·책임·공유는 부족", summary: "타인을 존중하는 따뜻한 마음을 가졌지만, 정보의 진위나 공유의 책임에 대해서는 무심한 경향이 있어요. 정보를 접할 때 비판적인 태도를 갖도록 노력해보세요." },
            "CRDT": { title: "무심한 방관형", description: "존중은 하지만, 확인과 책임감이 부족", summary: "의도는 좋지만, 디지털 활동에 대한 깊은 고민은 부족해요. 가짜 정보에 쉽게 노출될 수 있어 주의가 필요합니다. 정보 확인 습관을 기르는 것부터 시작해 보세요." },
            "CERH": { title: "말썽꾸러기형", description: "존중하지 않고 대신 시키지만, 가끔 정직하려고 애씀", summary: "감정을 앞세우고 책임감이 부족하지만, 때때로 올바른 행동을 하려는 양심이 있습니다. 자신의 행동이 타인에게 어떤 영향을 미칠지 먼저 고민하는 습관을 들이세요." },
            "CERS": { title: "감정 폭풍형", description: "감정과 즉흥성이 강해서 디지털 세상에 혼란을 줌", summary: "감정을 그대로 드러내는 경향이 강해 온라인에서 충동적인 행동을 할 수 있습니다. 한 발 물러서서 생각하고, 감정을 조절하는 연습이 필요합니다." },
            "CRHS🌱": { title: "성장 중인 시민형", description: "존중은 있지만 아직 훈련 필요", summary: "디지털 시민으로서의 기본적인 태도는 갖췄지만, 좀 더 적극적인 윤리 실천이 필요해요. 꾸준한 관심과 노력이 좋은 습관을 만들어 줄 겁니다." },
            "VERH🏅": { title: "디지털 시민 영웅", description: "거의 완벽한 디지털 윤리 지킴이", summary: "최고 모범형🏅 당신의 모범적인 태도는 다른 사람들에게 큰 귀감이 될 거예요!" },
            "CEDS🚨": { title: "디지털 위험 탐험가", description: "모든 선택이 비윤리적", summary: "경고🚨 당신의 디지털 습관은 매우 위험합니다. 온라인에서 가짜 정보에 쉽게 속고, 타인에게 피해를 줄 수 있어요. 지금 당장 훈련이 필요합니다." },
        };
        
        // 보정 기준에 따른 최종 성향
        const overallResults = {
            "low": { title: "🚨 디지털 위험 탐험형", summary: "디지털 윤리 태도가 전반적으로 부족하여 위험에 노출될 가능성이 높습니다. 기초부터 차근차근 훈련하는 것이 시급해요." },
            "mid": { title: "🌱 디지털 시민 성장형", summary: "좋은 디지털 습관을 기르고 있는 중입니다. 조금만 더 노력하면 더 나은 디지털 시민이 될 수 있어요!" },
            "high": { title: "🌟 디지털 윤리 지킴이형", summary: "모범적인 디지털 윤리 태도를 지녔습니다. 당신은 디지털 세상의 든든한 수호자예요! 칭찬합니다." }
        };

        let currentScenarioIndex = 0;
        let currentScenarios = [];
        let userChoices = {};
        let selectedSpanId = null;
        let gameMissionIndex = 0;
        let gameScore = 0;
        let collectedItems = []; // Add new global variable for collected items
        const gameItems = [
            "✨ 지혜의 별",
            "💡 책임감의 전구",
            "🧭 정직의 나침반",
            "🛡️ 존중의 방패",
            "🔍 비판적 사고의 돋보기"
        ];
        let mbtiScores = { V: 0, R: 0, H: 0, T: 0 }; // V, R, H, T 점수만 기록
        let mbtiQuestionIndex = 0;
        
        // DOM Elements
        const app = document.getElementById('app');
        const modeSelectionScreen = document.getElementById('mode-selection-screen');
        const introScreen = document.getElementById('intro-screen');
        const trainingScreen = document.getElementById('training-screen');
        const feedbackScreen = document.getElementById('feedback-screen');
        const gameScreen = document.getElementById('game-screen');
        const mbtiScreen = document.getElementById('mbti-screen');
        const digitalEthicsBtn = document.getElementById('digital-ethics-btn');
        const promptWritingBtn = document.getElementById('prompt-writing-btn');
        const gameBtn = document.getElementById('game-btn');
        const mbtiTestBtn = document.getElementById('mbti-test-btn');
        const startBtn = document.getElementById('start-btn');
        const factCheckBtn = document.getElementById('fact-check-btn');
        const sidebarTitle = document.getElementById('sidebar-title');
        const sidebarList = document.getElementById('sidebar-list');
        const gameStartBtn = document.getElementById('game-start-btn');
        const gameMissionEl = document.getElementById('game-mission');
        const gameIntroEl = document.getElementById('game-intro');
        const missionTitleEl = document.getElementById('mission-title');
        const missionSituationEl = document.getElementById('mission-situation');
        const gameChoicesEl = document.getElementById('game-choices');
        const gameFeedbackEl = document.getElementById('game-feedback');
        const feedbackTitleEl = document.getElementById('feedback-title');
        const feedbackMessageEl = document.getElementById('feedback-message');
        const nextMissionBtn = document.getElementById('next-mission-btn');
        const homeBtn = document.getElementById('home-btn');
        const gameScoreEl = document.getElementById('game-score');
        const missionNumberEl = document.getElementById('mission-number');
        const mbtiStartBtn = document.getElementById('mbti-start-btn');
        const mbtiIntroEl = document.getElementById('mbti-intro');
        const mbtiQuizEl = document.getElementById('mbti-quiz');
        const mbtiQuestionEl = document.getElementById('mbti-question');
        const mbtiChoicesEl = document.getElementById('mbti-choices');
        const mbtiResultEl = document.getElementById('mbti-result');
        const mbtiResultTitleEl = document.getElementById('mbti-result-title');
        const mbtiResultDescEl = document.getElementById('mbti-result-description');
        const mbtiResultSummaryEl = document.getElementById('mbti-result-summary');
        const mbtiCurrentQEl = document.getElementById('mbti-current-q');
        const mbtiTotalQEl = document.getElementById('mbti-total-q');
        const mbtiProgressBarEl = document.getElementById('mbti-progress-bar');
        const mbtiHomeBtn = document.getElementById('mbti-home-btn');


        let currentMode = '';

        digitalEthicsBtn.addEventListener('click', () => {
            currentMode = 'ethics';
            currentScenarios = digitalEthicsScenarios;
            modeSelectionScreen.classList.add('hidden');
            introScreen.classList.remove('hidden');
            trainingScreen.classList.add('hidden');
            gameScreen.classList.add('hidden');
            mbtiScreen.classList.add('hidden');
            document.getElementById('ethics-section').classList.remove('hidden');
            document.getElementById('prompt-section').classList.add('hidden');
            document.getElementById('training-guide').classList.remove('hidden');
            updateSidebarForMode();
        });

        promptWritingBtn.addEventListener('click', () => {
            currentMode = 'prompt';
            currentScenarios = promptWritingScenarios;
            modeSelectionScreen.classList.add('hidden');
            introScreen.classList.remove('hidden');
            trainingScreen.classList.add('hidden');
            gameScreen.classList.add('hidden');
            mbtiScreen.classList.add('hidden');
            document.getElementById('ethics-section').classList.add('hidden');
            document.getElementById('prompt-section').classList.remove('hidden');
            document.getElementById('training-guide').classList.remove('hidden');
            updateSidebarForMode();
        });

        gameBtn.addEventListener('click', () => {
            currentMode = 'game';
            gameMissionIndex = 0;
            gameScore = 0;
            collectedItems = []; // Reset collected items
            modeSelectionScreen.classList.add('hidden');
            introScreen.classList.add('hidden');
            trainingScreen.classList.add('hidden');
            gameScreen.classList.remove('hidden');
            mbtiScreen.classList.add('hidden');
            gameIntroEl.classList.remove('hidden');
            gameMissionEl.classList.add('hidden');
            gameFeedbackEl.classList.add('hidden');
            updateSidebarForMode();
        });

        mbtiTestBtn.addEventListener('click', () => {
            currentMode = 'mbti';
            modeSelectionScreen.classList.add('hidden');
            introScreen.classList.add('hidden');
            trainingScreen.classList.add('hidden');
            gameScreen.classList.add('hidden');
            mbtiScreen.classList.remove('hidden');
            mbtiIntroEl.classList.remove('hidden');
            mbtiQuizEl.classList.add('hidden');
            mbtiResultEl.classList.add('hidden');
            updateSidebarForMode();
        });

        mbtiStartBtn.addEventListener('click', () => {
            mbtiIntroEl.classList.add('hidden');
            mbtiQuizEl.classList.remove('hidden');
            mbtiScores = { V: 0, R: 0, H: 0, T: 0 };
            mbtiQuestionIndex = 0;
            mbtiTotalQEl.textContent = mbtiQuestionData.flatMap(axis => axis.questions).length;
            loadMbtiQuestion();
            updateSidebar(1);
        });

        mbtiHomeBtn.addEventListener('click', () => {
            mbtiScreen.classList.add('hidden');
            modeSelectionScreen.classList.remove('hidden');
            updateSidebarForMode();
        });

        function loadMbtiQuestion() {
            const allQuestions = mbtiQuestionData.flatMap(axis => axis.questions);
            const currentQ = allQuestions[mbtiQuestionIndex];
            mbtiCurrentQEl.textContent = mbtiQuestionIndex + 1;
            mbtiQuestionEl.textContent = currentQ.q;
            
            const progress = (mbtiQuestionIndex / allQuestions.length) * 100;
            mbtiProgressBarEl.style.width = `${progress}%`;
        }
        
        function handleMbtiChoice(isYes) {
            const allQuestions = mbtiQuestionData.flatMap(axis => axis.questions);
            const currentAxis = mbtiQuestionData.find(axis => axis.questions.includes(allQuestions[mbtiQuestionIndex]));
            const currentQ = allQuestions[mbtiQuestionIndex];
            
            // 윤리적 선택이면 점수 추가
            if ((isYes && currentQ.isEthical) || (!isYes && !currentQ.isEthical)) {
                mbtiScores[currentAxis.axis]++;
            }
            
            mbtiQuestionIndex++;

            if (mbtiQuestionIndex < allQuestions.length) {
                loadMbtiQuestion();
            } else {
                mbtiProgressBarEl.style.width = '100%';
                calculateMbtiResult();
            }
        }
        
        // MBTI 선택 버튼 이벤트 리스너 (그렇다/아니다)
        document.querySelectorAll('.mbti-choice-btn').forEach(btn => {
            btn.addEventListener('click', (e) => {
                const isYes = e.target.dataset.value === 'yes';
                handleMbtiChoice(isYes);
            });
        });

        function calculateMbtiResult() {
            let finalType = "";
            let finalResult = {};
            const totalScore = mbtiScores.V + mbtiScores.R + mbtiScores.H + mbtiScores.T;

            if (totalScore <= 7) {
                finalResult = overallResults.low;
            } else if (totalScore >= 15) {
                finalResult = overallResults.high;
            } else {
                finalResult = overallResults.mid;
            }

            // 각 축의 점수를 기준으로 최종 4자리 코드 생성
            const vType = mbtiScores.V >= 3 ? 'V' : 'C';
            const rType = mbtiScores.R >= 3 ? 'R' : 'E';
            const hType = mbtiScores.H >= 3 ? 'H' : 'D';
            const tType = mbtiScores.T >= 3 ? 'T' : 'S';
            
            finalType = vType + rType + hType + tType;

            // 최종 유형 조합
            let specificResult = mbtiResults[finalType];
            if (!specificResult) {
                specificResult = {
                    title: "알 수 없는 유형",
                    description: "아직 정의되지 않은 조합입니다.",
                    summary: "선택하신 조합에 대한 정보가 부족합니다."
                }
            }

            // 총점에 따른 보정 기준으로 최종 결과 확정
            if (totalScore <= 7) { // 0~7점
                finalResult.description = specificResult.description;
                finalResult.summary = specificResult.summary;
                if (finalType === 'CEDS') {
                    finalResult.title = mbtiResults['CEDS🚨'].title;
                    finalResult.description = mbtiResults['CEDS🚨'].description;
                    finalResult.summary = mbtiResults['CEDS🚨'].summary;
                }
            } else if (totalScore >= 15) { // 15~20점
                finalResult.description = specificResult.description;
                finalResult.summary = specificResult.summary;
                if (finalType === 'VRHT') {
                    finalResult.title = mbtiResults['VERH🏅'].title;
                    finalResult.description = mbtiResults['VERH🏅'].description;
                    finalResult.summary = mbtiResults['VERH🏅'].summary;
                }
            } else { // 8~14점
                finalResult.description = specificResult.description;
                finalResult.summary = specificResult.summary;
            }

            showMbtiResult(finalResult, finalType);
            updateSidebar(2);
        }

        function showMbtiResult(result, type) {
            mbtiQuizEl.classList.add('hidden');
            mbtiResultEl.classList.remove('hidden');
            mbtiResultTitleEl.textContent = `${result.title} (${type}형)`;
            mbtiResultDescEl.innerHTML = result.description;
            mbtiResultSummaryEl.textContent = result.summary;
        }

        gameStartBtn.addEventListener('click', () => {
            gameIntroEl.classList.add('hidden');
            gameMissionEl.classList.remove('hidden');
            document.getElementById('item-list').innerHTML = ''; // Clear items on new game start
            loadGameMission(gameMissionIndex);
        });

        nextMissionBtn.addEventListener('click', () => {
            gameMissionIndex++;
            if (gameMissionIndex < gameScenarios.length) {
                gameFeedbackEl.classList.add('hidden');
                gameMissionEl.classList.remove('hidden');
                loadGameMission(gameMissionIndex);
            } else {
                // Game End
                gameFeedbackEl.classList.add('hidden');
                gameIntroEl.classList.remove('hidden');
                const itemsText = collectedItems.length > 0 ? `\n\n획득한 보물: ${collectedItems.join(', ')}` : '';
                alert(`축하합니다! 모든 미션을 완료하고 'AI 윤리의 수호자' 칭호를 얻었습니다! 총점: ${gameScore}점${itemsText}`);
                modeSelectionScreen.classList.remove('hidden');
                gameScreen.classList.add('hidden');
                updateSidebarForMode();
            }
        });

        function loadGameMission(index) {
            const mission = gameScenarios[index];
            missionTitleEl.textContent = mission.mission;
            missionSituationEl.textContent = mission.situation;
            missionNumberEl.textContent = index + 1;
            gameChoicesEl.innerHTML = '';
            mission.choices.forEach(choice => {
                const button = document.createElement('button');
                button.textContent = choice.text;
                button.className = 'w-full md:w-auto bg-blue-500 hover:bg-blue-600 text-white font-bold py-3 px-8 rounded-lg shadow-md transition-transform transform hover:scale-105';
                button.addEventListener('click', () => handleGameChoice(choice, mission));
                gameChoicesEl.appendChild(button);
            });
        }
        
        function handleGameChoice(choice, mission) {
            gameMissionEl.classList.add('hidden');
            gameFeedbackEl.classList.remove('hidden');
            let feedback = '';

            if (choice.correct) {
                feedbackTitleEl.textContent = "미션 성공! 🎉";
                feedbackTitleEl.classList.remove('text-red-600');
                feedbackTitleEl.classList.add('text-green-600');
                gameScore += 20; // Correct answer gives 20 points
                gameScoreEl.textContent = gameScore;

                // Give an item!
                const item = gameItems[mission.id]; // Use mission ID to get a unique item
                if (item) {
                    collectedItems.push(item);
                    const itemEl = document.createElement('span');
                    itemEl.textContent = item;
                    itemEl.className = 'bg-yellow-200 text-yellow-800 px-2 py-1 rounded-full text-xs font-semibold';
                    document.getElementById('item-list').appendChild(itemEl);

                    feedback = `
                        <p class="mb-4 text-green-600 font-bold">${choice.feedback}</p>
                        <p class="mb-2 font-bold text-green-600">🎉 새로운 보물 획득! 🎉</p>
                        <p class="text-xl font-bold mb-4 text-yellow-600">${item}</p>
                        <p>${choice.rationale}</p>
                    `;
                } else {
                    feedback = `
                        <p class="mb-4 text-green-600 font-bold">${choice.feedback}</p>
                        <p>${choice.rationale}</p>
                    `;
                }

            } else {
                feedbackTitleEl.textContent = "미션 실패... 😢";
                feedbackTitleEl.classList.remove('text-green-600');
                feedbackTitleEl.classList.add('text-red-600');
                
                const correctChoice = mission.choices.find(c => c.correct);
                feedback = `
                    <p class="mb-4 text-red-600 font-bold">${choice.feedback}</p>
                    <p class="mb-2 font-bold text-green-600">✨ 정답 해설 ✨</p>
                    <p>${correctChoice.rationale}</p>
                `;
            }
            feedbackMessageEl.innerHTML = feedback;
        }

        function updateSidebarForMode() {
            if (currentMode === 'ethics') {
                sidebarTitle.textContent = '디지털 윤리 훈련 순서';
                sidebarList.innerHTML = `
                    <li id="sidebar-step-0" class="flex items-center space-x-3 p-3 rounded-lg transition-all duration-300 transform hover:scale-105">
                        <div class="w-8 h-8 flex items-center justify-center bg-blue-500 rounded-full text-white font-bold text-lg">①</div>
                        <span class="font-semibold">AI를 대하는 올바른 태도</span>
                    </li>
                    <li id="sidebar-step-1" class="flex items-center space-x-3 p-3 rounded-lg transition-all duration-300">
                        <div class="w-8 h-8 flex items-center justify-center bg-gray-300 rounded-full text-gray-600 font-bold text-lg">②</div>
                        <span class="font-semibold">AI 글 분석</span>
                    </li>
                    <li id="sidebar-step-2" class="flex items-center space-x-3 p-3 rounded-lg transition-all duration-300">
                        <div class="w-8 h-8 flex items-center justify-center bg-gray-300 rounded-full text-gray-600 font-bold text-lg">③</div>
                        <span class="font-semibold">훈련 결과 피드백</span>
                    </li>
                `;
                updateSidebar(0);
            } else if (currentMode === 'prompt') {
                sidebarTitle.textContent = '프롬프트 작성 훈련 순서';
                sidebarList.innerHTML = `
                    <li id="sidebar-step-0" class="flex items-center space-x-3 p-3 rounded-lg transition-all duration-300 transform hover:scale-105">
                        <div class="w-8 h-8 flex items-center justify-center bg-blue-500 rounded-full text-white font-bold text-lg">①</div>
                        <span class="font-semibold">프롬프트 작성법 학습</span>
                    </li>
                    <li id="sidebar-step-1" class="flex items-center space-x-3 p-3 rounded-lg transition-all duration-300">
                        <div class="w-8 h-8 flex items-center justify-center bg-gray-300 rounded-full text-gray-600 font-bold text-lg">②</div>
                        <span class="font-semibold">프롬프트 분석</span>
                    </li>
                    <li id="sidebar-step-2" class="flex items-center space-x-3 p-3 rounded-lg transition-all duration-300">
                        <div class="w-8 h-8 flex items-center justify-center bg-gray-300 rounded-full text-gray-600 font-bold text-lg">③</div>
                        <span class="font-semibold">훈련 결과 피드백</span>
                    </li>
                `;
                document.getElementById('fact-check-btn').classList.add('hidden');
                updateSidebar(0);
            } else if (currentMode === 'game') {
                 sidebarTitle.textContent = 'AI 윤리 모험 순서';
                 sidebarList.innerHTML = `
                     <li id="sidebar-step-0" class="flex items-center space-x-3 p-3 rounded-lg transition-all duration-300 transform hover:scale-105">
                         <div class="w-8 h-8 flex items-center justify-center bg-blue-500 rounded-full text-white font-bold text-lg">①</div>
                         <span class="font-semibold">게임 시작</span>
                     </li>
                     <li id="sidebar-step-1" class="flex items-center space-x-3 p-3 rounded-lg transition-all duration-300">
                         <div class="w-8 h-8 flex items-center justify-center bg-gray-300 rounded-full text-gray-600 font-bold text-lg">②</div>
                         <span class="font-semibold">미션 해결</span>
                     </li>
                     <li id="sidebar-step-2" class="flex items-center space-x-3 p-3 rounded-lg transition-all duration-300">
                         <div class="w-8 h-8 flex items-center justify-center bg-gray-300 rounded-full text-gray-600 font-bold text-lg">③</div>
                         <span class="font-semibold">결과 확인</span>
                     </li>
                 `;
                 updateSidebar(0);
            } else if (currentMode === 'mbti') {
                sidebarTitle.textContent = '디지털 윤리 MBTI';
                sidebarList.innerHTML = `
                    <li id="sidebar-step-0" class="flex items-center space-x-3 p-3 rounded-lg transition-all duration-300 transform hover:scale-105">
                        <div class="w-8 h-8 flex items-center justify-center bg-blue-500 rounded-full text-white font-bold text-lg">①</div>
                        <span class="font-semibold">진단 시작</span>
                    </li>
                    <li id="sidebar-step-1" class="flex items-center space-x-3 p-3 rounded-lg transition-all duration-300">
                        <div class="w-8 h-8 flex items-center justify-center bg-gray-300 rounded-full text-gray-600 font-bold text-lg">②</div>
                        <span class="font-semibold">문제 풀기</span>
                    </li>
                    <li id="sidebar-step-2" class="flex items-center space-x-3 p-3 rounded-lg transition-all duration-300">
                        <div class="w-8 h-8 flex items-center justify-center bg-gray-300 rounded-full text-gray-600 font-bold text-lg">③</div>
                        <span class="font-semibold">결과 확인</span>
                    </li>
                `;
                updateSidebar(0);
            }
        }

        function updateSidebar(step) {
            const sidebarSteps = sidebarList.querySelectorAll('li');
            sidebarSteps.forEach((element, index) => {
                const iconDiv = element.querySelector('div');
                if (index === step) {
                    element.classList.remove('text-gray-400');
                    element.classList.add('text-blue-600', 'font-bold');
                    iconDiv.classList.remove('bg-gray-300', 'text-gray-600');
                    iconDiv.classList.add('bg-blue-500', 'text-white');
                } else {
                    element.classList.remove('text-blue-600', 'font-bold');
                    element.classList.add('text-gray-400');
                    iconDiv.classList.remove('bg-blue-500', 'text-white');
                    iconDiv.classList.add('bg-gray-300', 'text-gray-600');
                }
            });
        }
        
        function initializeTraining() {
            introScreen.classList.add('hidden');
            feedbackScreen.classList.add('hidden');
            trainingScreen.classList.remove('hidden');
            currentScenarioIndex = 0;
            loadScenario(currentScenarioIndex);
            updateSidebar(1);
        }

        function loadScenario(index) {
            const scenario = currentScenarios[index];
            if (!scenario) return;

            userChoices = {};
            selectedSpanId = null;
            document.getElementById('edit-area').classList.add('hidden');
            
            document.getElementById('scenario-title').textContent = scenario.title;
            document.getElementById('scenario-instruction').textContent = scenario.instruction;
            
            let processedText;
            if (currentMode === 'ethics') {
                processedText = scenario.fullText;
                const sortedProblems = [...scenario.problems].sort((a, b) => b.textToWrap.length - a.textToWrap.length);
                sortedProblems.forEach(prob => {
                    const problemIndex = scenario.problems.indexOf(prob);
                    const spanId = `problem-${index}-${problemIndex}`;
                    if (!processedText.includes(`id="${spanId}"`)) {
                        processedText = processedText.replace(
                            prob.textToWrap,
                            `<span id="${spanId}" class="problem-span p-1" data-problem-index="${problemIndex}">${prob.textToWrap}</span>`
                        );
                    }
                });
                document.getElementById('ai-text-content').innerHTML = processedText;
                document.getElementById('fact-check-btn').classList.remove('hidden');
                document.getElementById('keep-btn').classList.remove('hidden');
                document.getElementById('edit-btn').textContent = "✏️ 직접 수정하기";

            } else if (currentMode === 'prompt') {
                processedText = scenario.aiResponse;
                const problem = scenario.problems[0];
                const spanId = `problem-${index}-0`;
                processedText = processedText.replace(
                    problem.textToWrap,
                    `<span id="${spanId}" class="problem-span p-1" data-problem-index="0">${problem.textToWrap}</span>`
                );
                document.getElementById('ai-text-content').innerHTML = `
                    <p class="font-semibold text-gray-700 mb-2">⭐ 내가 쓴 프롬프트: </p>
                    <p class="mb-4 p-3 bg-gray-100 rounded-md">${scenario.userPrompt}</p>
                    <p class="font-semibold text-gray-700 mb-2">🤖 AI의 답변:</p>
                    <p>${processedText}</p>
                `;
                document.getElementById('fact-check-btn').classList.add('hidden');
                document.getElementById('keep-btn').classList.add('hidden');
                document.getElementById('edit-btn').textContent = "✏️ 개선된 프롬프트 작성하기";
            }
            showDefaultInteraction();
        }

        function handleSpanClick(e) {
            const target = e.target;
            if (target.classList.contains('problem-span')) {
                document.querySelectorAll('.problem-span.selected').forEach(el => el.classList.remove('selected'));
                target.classList.add('selected');
                selectedSpanId = target.id;
                const problemIndex = target.dataset.problemIndex;
                const problem = currentScenarios[currentScenarioIndex].problems[problemIndex];
                showInteractionContent(problem);
            }
        }
        
        function showDefaultInteraction() {
            document.getElementById('interaction-default').classList.remove('hidden');
            document.getElementById('interaction-content').classList.add('hidden');
        }

        function showInteractionContent(problem) {
            document.getElementById('interaction-default').classList.add('hidden');
            document.getElementById('interaction-content').classList.remove('hidden');
            document.getElementById('criteria-box').innerHTML = problem.criteria;
            document.getElementById('edit-area').classList.add('hidden');
        }
        
        function handleEdit() {
            if (!selectedSpanId) return;
            const editArea = document.getElementById('edit-area');
            const textarea = document.getElementById('edit-textarea');
            const originalText = document.getElementById(selectedSpanId).textContent;
            textarea.value = userChoices[selectedSpanId]?.editedText || originalText;
            editArea.classList.remove('hidden');
        }
        
        function handleFactCheck() {
            if (!selectedSpanId) return;
            
            const originalText = factCheckBtn.innerHTML;
            factCheckBtn.innerHTML = '<div class="loading-spinner"></div>';
            factCheckBtn.disabled = true;

            setTimeout(() => {
                const problemIndex = document.getElementById(selectedSpanId).dataset.problemIndex;
                const problem = currentScenarios[currentScenarioIndex].problems[problemIndex];
                const result = problem.factCheckResult;

                const dialogBox = document.createElement('div');
                dialogBox.textContent = `진단 결과: ${result}`;
                dialogBox.className = 'fixed top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2 bg-blue-500 text-white px-6 py-3 rounded-lg shadow-xl text-center z-50';
                document.body.appendChild(dialogBox);
                
                setTimeout(() => {
                    dialogBox.remove();
                    factCheckBtn.innerHTML = originalText;
                    factCheckBtn.disabled = false;
                }, 2000);
            }, 1000);
        }

        function handleKeep() {
            if (!selectedSpanId) return;
            userChoices[selectedSpanId] = { decision: 'keep' };
            const dialogBox = document.createElement('div');
            dialogBox.textContent = '유지하기로 선택했습니다.';
            dialogBox.className = 'fixed top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2 bg-green-500 text-white px-6 py-3 rounded-lg shadow-xl text-center z-50';
            document.body.appendChild(dialogBox);
            setTimeout(() => {
                dialogBox.remove();
            }, 1500);

            document.getElementById(selectedSpanId).style.backgroundColor = '#dcfce7'; // green-100
            resetInteraction();
        }

        function handleSaveEdit() {
            if (!selectedSpanId) return;
            const newText = document.getElementById('edit-textarea').value;
            userChoices[selectedSpanId] = {
                decision: 'edit',
                editedText: newText,
                originalText: document.getElementById(selectedSpanId).textContent
            };
            document.getElementById(selectedSpanId).style.backgroundColor = '#fef9c3'; // yellow-100

            const dialogBox = document.createElement('div');
            dialogBox.textContent = '수정 내용이 저장되었습니다.';
            dialogBox.className = 'fixed top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2 bg-blue-500 text-white px-6 py-3 rounded-lg shadow-xl text-center z-50';
            document.body.appendChild(dialogBox);
            setTimeout(() => {
                dialogBox.remove();
            }, 1500);

            resetInteraction();
        }

        function resetInteraction() {
            document.getElementById('edit-area').classList.add('hidden');
            showDefaultInteraction();
            if (selectedSpanId) {
                document.getElementById(selectedSpanId)?.classList.remove('selected');
                selectedSpanId = null;
            }
        }
        
        function showFeedback() {
            trainingScreen.classList.add('hidden');
            feedbackScreen.classList.remove('hidden');
            updateSidebar(2);

            const scenario = currentScenarios[currentScenarioIndex];
            let feedbackText = scenario.fullText || scenario.aiResponse;
            let summaryHtml = '<ul class="space-y-4">';
            let correctCount = 0;
            
            scenario.problems.forEach((prob, i) => {
                const spanId = `problem-${currentScenarioIndex}-${i}`;
                const choice = userChoices[spanId];
                let replacementText = prob.textToWrap;
                let isCorrect = false;

                if (choice) {
                    if (choice.decision === 'edit' && prob.isCritical) {
                        replacementText = `<span class="feedback-correct p-1 rounded font-bold" title="수정됨: ${choice.editedText}">${choice.editedText}</span>`;
                        summaryHtml += `<li class="flex items-start"><span class="text-green-500 mr-2">✔️</span><div><strong>'${prob.textToWrap}'</strong> 부분을 잘 수정했습니다. ${prob.explanation}</div></li>`;
                        isCorrect = true;
                    } else if (choice.decision === 'keep' && !prob.isCritical) {
                        replacementText = `<span class="feedback-correct p-1 rounded">${prob.textToWrap}</span>`;
                        summaryHtml += `<li class="flex items-start"><span class="text-green-500 mr-2">✔️</span><div><strong>'${prob.textToWrap}'</strong> 부분을 유지한 판단이 좋습니다. ${prob.explanation}</div></li>`;
                        isCorrect = true;
                    } else {
                        replacementText = `<span class="feedback-incorrect p-1 rounded font-bold">${choice.originalText || prob.textToWrap}</span>`;
                        const reason = choice.decision === 'keep' ? '수정이 필요한 부분이었지만 유지했습니다.' : '수정할 필요가 없는 부분이었습니다.';
                        summaryHtml += `<li class="flex items-start"><span class="text-red-500 mr-2">❌</span><div><strong>'${prob.textToWrap}'</strong> 부분에 대한 판단이 아쉬워요. ${reason} ${prob.explanation}</div></li>`;
                    }
                } else {
                    if (prob.isCritical) {
                        replacementText = `<span class="feedback-missed p-1 rounded">${prob.textToWrap}</span>`;
                        summaryHtml += `<li class="flex items-start"><span class="text-orange-500 mr-2">⚠️</span><div><strong>'${prob.textToWrap}'</strong> 부분은 수정이 필요한 부분이었지만 놓쳤습니다. ${prob.explanation}</div></li>`;
                    } else {
                         summaryHtml += `<li class="flex items-start"><span class="text-gray-500 mr-2">ℹ️</span><div><strong>'${prob.textToWrap}'</strong> 부분도 검토해볼 수 있었어요. ${prob.explanation}</div></li>`;
                         isCorrect = true;
                    }
                }
                
                if (isCorrect) correctCount++;
                feedbackText = feedbackText.replace(prob.textToWrap, replacementText);
            });

            summaryHtml += '</ul>';
            const score = scenario.problems.length > 0 ? Math.round((correctCount / scenario.problems.length) * 100) : 100;
            summaryHtml = `<p class="mb-4 text-center font-bold text-xl">총 ${scenario.problems.length}개 중 ${correctCount}개를 올바르게 판단했습니다! (점수: ${score}점)</p>` + summaryHtml;

            if (currentMode === 'prompt') {
                const userPrompt = scenario.userPrompt;
                const problem = scenario.problems[0];
                const choice = userChoices[`problem-${currentScenarioIndex}-0`];
                const editedPrompt = choice?.editedText || "프롬프트가 수정되지 않았습니다.";
                
                summaryHtml += `
                    <div class="mt-6 p-4 bg-gray-100 rounded-lg">
                        <h4 class="font-bold text-lg mb-2">✨ 제안하는 개선 프롬프트</h4>
                        <p class="p-3 bg-white rounded-md whitespace-pre-wrap">${editedPrompt}</p>
                    </div>
                    <div class="mt-4 p-4 bg-gray-100 rounded-lg">
                        <h4 class="font-bold text-lg mb-2">💡 해설</h4>
                        <p>${problem.explanation}</p>
                    </div>
                `;
            } else {
                let processedFinalText = scenario.fullText;
                const sortedProblems = [...scenario.problems].sort((a, b) => b.textToWrap.length - a.textToWrap.length);
                sortedProblems.forEach(prob => {
                    const spanId = `problem-${currentScenarioIndex}-${scenario.problems.indexOf(prob)}`;
                    const choice = userChoices[spanId];
                    if (choice && choice.decision === 'edit') {
                        processedFinalText = processedFinalText.replace(prob.textToWrap, choice.editedText);
                    }
                });
                feedbackText = processedFinalText;
            }

            document.getElementById('feedback-text-content').innerHTML = feedbackText;
            document.getElementById('feedback-summary').innerHTML = summaryHtml;
            
            const nextBtn = document.getElementById('next-btn');
            if (currentScenarioIndex < currentScenarios.length - 1) {
                nextBtn.textContent = '다음 훈련으로';
            } else {
                nextBtn.textContent = '첫 화면으로';
            }
        }

        // Event Listeners
        startBtn.addEventListener('click', initializeTraining);

        document.getElementById('ai-text-content').addEventListener('click', handleSpanClick);
        document.getElementById('fact-check-btn').addEventListener('click', handleFactCheck);
        document.getElementById('edit-btn').addEventListener('click', handleEdit);
        document.getElementById('keep-btn').addEventListener('click', handleKeep);
        document.getElementById('save-edit-btn').addEventListener('click', handleSaveEdit);
        document.getElementById('submit-btn').addEventListener('click', showFeedback);
        
        document.getElementById('retry-btn').addEventListener('click', () => {
            feedbackScreen.classList.add('hidden');
            trainingScreen.classList.remove('hidden');
            loadScenario(currentScenarioIndex);
            updateSidebar(1);
        });

        document.getElementById('next-btn').addEventListener('click', () => {
            feedbackScreen.classList.add('hidden');
            if (currentScenarioIndex < currentScenarios.length - 1) {
                currentScenarioIndex++;
                trainingScreen.classList.remove('hidden');
                loadScenario(currentScenarioIndex);
                updateSidebar(1);
            } else {
                modeSelectionScreen.classList.remove('hidden');
                introScreen.classList.add('hidden');
            }
        });

        // Initial sidebar state
        updateSidebarForMode();
    </script>
</body>
</html>

